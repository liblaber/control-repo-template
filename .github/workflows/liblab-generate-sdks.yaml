name: Generate SDKs using liblab

on:
  workflow_call:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - 'liblab.config.json'
      - 'spec.json'
      - 'hooks/**'
jobs:
  build-and-pr:
    name: Generate SDKs and create PRs
    runs-on: ubuntu-latest
    env:
      LIBLAB_TOKEN: ${{ secrets.LIBLAB_TOKEN }}
      GITHUB_TOKEN: ${{ secrets.LIBLAB_GITHUB_TOKEN }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Node.js environment
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Verify liblab token
        if: ${{ env.LIBLAB_TOKEN == '' }}
        run: echo "::warning::LIBLAB_TOKEN has not been set"
      - name: Verify github token
        if: ${{ env.LIBLAB_GITHUB_TOKEN == '' }}
        run: echo "::warning::LIBLAB_GITHUB_TOKEN has not been set"
      - name: Generate an SDK and create a PR
        if: ${{ env.LIBLAB_TOKEN != '' && env.LIBLAB_GITHUB_TOKEN != '' }}
        run: |
          npm install -g liblab
          liblab build --yes
          liblab pr